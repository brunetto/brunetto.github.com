<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <title>
    GIF2 files Python reader // Post It!
  </title>

  <link href="http://gmpg.org/xfn/11" rel="profile">
<meta http-equiv="content-type" content="text/html; charset=utf-8">


<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

<meta name="description" content="">
<meta name="keywords" content="">
<meta name="author" content="Brunetto Ziosi">

  <meta property="og:title" content="GIF2 files Python reader" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:locale" content="en_US" />
<meta property="og:url" content="http://brunettoziosi.eu/posts/gif2-files-python-reader/" />


  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/base-min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/pure-min.css">
  
  
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/grids-responsive-min.css">
  
  

  <link rel="stylesheet" href="http://brunettoziosi.eu/css/redlounge.css">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
  <link href='//fonts.googleapis.com/css?family=Raleway:400,200,100,700,300,500,600,800' rel='stylesheet' type='text/css'>
  <link href='//fonts.googleapis.com/css?family=Libre+Baskerville:400,700,400italic' rel='stylesheet' type='text/css'>

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.svg">

  
  <link href="" rel="alternate" type="application/rss+xml" title="Post It!" />

    
  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/tomorrow-night-bright.min.css">
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>


  

  

  
</head>

<body>
	

	<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
  <div class="header">
    

    <h1 class="brand-title">Post It!</h1>
    <h2 class="brand-tagline">Sticky digital notes
    </br>stuck on the Web!üòÉ</h2>

    <nav class="nav">
      <ul class="nav-list">
        <li class="nav-item"><span class="nav-item-separator">//</span><a href="http://brunettoziosi.eu">Home</a></li>
        
          <li class="nav-item"><span class="nav-item-separator">//</span><a href="/posts/">Blog</a></li>
        
          <li class="nav-item"><span class="nav-item-separator">//</span><a href="/pages/curriculum-vitae/">CV</a></li>
        
          <li class="nav-item"><span class="nav-item-separator">//</span><a href="/pages/">Pages</a></li>
        
      </ul>
    </nav>

    
    <div class="social-buttons">
      
        
        <a href="http://www.linkedin.com/in/brunettoziosi" target="_blank"><i class='fa fa-linkedin'></i></a>
        
      
        
        <a href="https://instagram.com/elbrunz/" target="_blank"><i class='fa fa-instagram'></i></a>
        
      
        
        <a href="http://www.twitter.com/brunettoziosi" target="_blank"><i class='fa fa-twitter'></i></a>
        
      
        
        <a href="http://plus.google.com/&#43;BrunettoZiosi" target="_blank"><i class='fa fa-google-plus'></i></a>
        
      
        
        <a href="http://www.github.com/brunetto" target="_blank"><i class='fa fa-github'></i></a>
        
      
        
        <a href="http://www.facebook.com/brunettoziosi" target="_blank"><i class='fa fa-facebook'></i></a>
        
      
      
    </div>
    

  </div>
</div>

	
	

    <div class="content pure-u-1 pure-u-md-3-4">
		<a name="top"></a>
		

		
			
	    
  		<section class="post">
            <h1 class="post-title">
              <a href="/posts/gif2-files-python-reader/">GIF2 files Python reader</a>
            </h1>
            <h3 class="post-subtitle">
            	
            </h3>
            
            	<span class="post-date">
                	<span class="post-date-day"><sup>6</sup></span><span class="post-date-separator">/</span><span class="post-date-month">Dec</span> <span class="post-date-year">2011</span>
            	</span>
            	
            
            
            
            
            	
            		<span class="post-author-single">By <a class="post-author" href="http://brunettoziosi.eu" target="">Brunetto Ziosi</a></span>
            		




            	
            
            

			
			
				<div class="post-categories">
				
					<a class="post-category post-category-research" href="http://brunettoziosi.eu/categories/research">Research</a>
				
					<a class="post-category post-category-python" href="http://brunettoziosi.eu/categories/python">Python</a>
				
					<a class="post-category post-category-programming" href="http://brunettoziosi.eu/categories/programming">Programming</a>
				
					<a class="post-category post-category-post" href="http://brunettoziosi.eu/categories/post">Post</a>
				
				</div>
			

			
		    	<div class="social-sharing">
	<a class="share-button-facebook" onClick="return popupShare(this.href);" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fbrunettoziosi.eu%2fposts%2fgif2-files-python-reader%2f" target="_blank"><i class="fa fa-facebook"><span>Like</span></i></a>
	<a class="share-button-google-plus" onClick="return popupShare(this.href);" href="https://plus.google.com/share?url=http%3a%2f%2fbrunettoziosi.eu%2fposts%2fgif2-files-python-reader%2f" target="_blank"><i class="fa fa-google-plus"><span>Google +1</span></i></a>
	<a class="share-button-linkedin" onClick="return popupShare(this.href);" href="http://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2fbrunettoziosi.eu%2fposts%2fgif2-files-python-reader%2f&title=GIF2%20files%20Python%20reader&summary=I%20create%20this%20script%20on%20the%20basis%20of%20the%20code%20to%20read%20the%20Millennium%20II%20data%20%28the%20same%20used%20here%29%20provided%20by%20Mike%20Boylan-Kolchin.%20Being%20allowed%20to%20read%20the%20Fortran%20code%20to%20write%20and%20read%20the%20GIF2%20files%20I%20could%20adapt%20this%20script%20to%20exactly%20fit%20this%20problem.%20import%20numpy%20as%20np%20import%20sys%20class%20head%3a%20def%20__init__%28self%2c%20fname%29%3a%20import%20types%20bo_mark%3d%27%26gt%3b%27%20%23%20start%20by%20reading%20in%20header%3a%20if%20type%28fname%29%20is%20types.StringType%3a%20f%3dopen%28fname%2c%20%27rb%27%29%20elif%20type%28fname%29%20is%20not%20types.FileType%3a%20raise%20TypeError%28%27argument%20must%20either%20be%20an%20open%20file%20or%20%27%20%2b%20%27a%20string%20containing%20a%20file%20name%27%29%20else%3a%20f%3dfname%20After%20the%20usual%20imports%20we%20define%20a%20class%20to%20read%20and%20contain%20the%20file%20header.}&source=Post%20It%21" target="_blank"><i class="fa fa-linkedin"><span>Share on LinkedIn</span></i></a>
	<a class="share-button-twitter" onClick="return popupShare(this.href);" href="http://twitter.com/share?text=GIF2%20files%20Python%20reader&url=http%3a%2f%2fbrunettoziosi.eu%2fposts%2fgif2-files-python-reader%2f" target="_blank"><i class="fa fa-twitter"><span>Tweet</span></i></a>	
</div>
		    

			

            <p>I create this script on the basis of the code to read the Millennium II data (the same used <a href="http://elbrunz.wordpress.com/2011/12/02/from-binaries-to-hdf5-using-python/" title="From binaries to HDF5 using¬†Python">here</a>) provided by <a href="http://mbk.ps.uci.edu/index.html" title="Mike Boylan-Kolchin">Mike Boylan-Kolchin</a>. Being allowed to read the Fortran code to write and read the GIF2 files I could adapt this script to exactly fit this problem.</p>

<!-- TEASER_END-->    

<pre><code class="language-python">import numpy as np
import sys

class head:
    def __init__(self, fname):
        import types
        bo_mark='&gt;'
        # start by reading in header:    
        if type(fname) is types.StringType:
            f=open(fname, 'rb')
        elif type(fname) is not types.FileType:
            raise TypeError('argument must either be an open file or ' + 
                            'a string containing a file name')
        else:
            f=fname
</code></pre>

<p>After the usual imports we define a class to read and contain the file header. These first lines check the &ldquo;filename&rdquo; argument.</p>

<pre><code class="language-python">self.pad = np.fromfile(f, count=1, dtype=bo_mark+'i4')
</code></pre>

<p>In the unformatted Fortran binary files the &ldquo;pad&rdquo; is a 4-byte space to separate the values of different quantities in the file. <code>bo_mark</code> contains the endianess (&ldquo;bo&rdquo; means byte order) of the system allowing Python to correctly interpret the numbers from the binary file. <code>count</code> sets the number of item of type <code>dtype</code> to be read. For example <code>count=3</code> and <code>dtype=bo_mark+'i4'</code> will store three 4-byte integer in the variable, with the byte order expressed by <code>bo_mark</code>, <code>&lt;</code> for big-endian, <code>&gt;</code> for little-endian.</p>

<pre><code class="language-python"># npart is an array containing the number of particles in the
        # file divided by type (gas, ...)
        self.npart = np.fromfile(f, count=6, dtype=bo_mark+'i4')
        self.massarr = np.fromfile(f, count=6, dtype=bo_mark+'f8')
        self.aaa = np.fromfile(f, count=1, dtype=bo_mark+'f8')
        self.redshift = np.fromfile(f, count=1, dtype=bo_mark+'f8')
        self.flag_sfr = np.fromfile(f, count=1, dtype=bo_mark+'i4')
        self.flag_feedback = np.fromfile(f, count=1, dtype=bo_mark+'i4')
        self.nall = np.fromfile(f, count=6, dtype=bo_mark+'i4')
        self.cooling_flag = np.fromfile(f, count=1, dtype=bo_mark+'i4')
        self.numfiles = np.fromfile(f, count=1, dtype=bo_mark+'i4')
        self.boxsize = np.fromfile(f, count=1, dtype=bo_mark+'f8')
        self.Omega = np.fromfile(f, count=1, dtype=bo_mark+'f8')
        self.OmegaL0 = np.fromfile(f, count=1, dtype=bo_mark+'f8')
        self.Hubblepar = np.fromfile(f, count=1, dtype=bo_mark+'f8')
        self.version = np.fromfile(f, count=1, dtype=bo_mark+'a96')
        self.pad2=np.fromfile(f, count=1, dtype=bo_mark+'i4')
        if type(fname) is types.StringType: f.close()
</code></pre>

<p>These lines read and store the values of the quantities saved in the header of the file.</p>

<pre><code class="language-python">def read_gif2_file(fname):
    bo_mark = '&gt;'
    f=open(fname, 'rb')
    # start by reading in header:    
    ghead=head(f)
    npt=ghead.npart.sum()````
    
This is the function we use to read the files: it set the endianness to &quot;big-endian&quot;, open the file in read-only mode, read the header and extract the total number of particles.    
````python
f.seek(4, 1)
    pos=np.fromfile(f, count=npt*3, dtype=bo_mark + 'f4').reshape((npt, 3))
    return pos
</code></pre>

<p><code>f.seek(offset, from_what)</code> move the pointer through the file to read bits from one position to another. The position is computed from adding <code>offset</code> to a reference point; the reference point is selected by the <code>from_what</code> argument. A <code>from_what</code> value of 0 measures from the beginning of the file, 1 uses the current file position, and 2 uses the end of the file as the reference point. <code>from_what</code> can be omitted and defaults to 0, using the beginning of the file as the reference point (from the <a href="http://docs.python.org/tutorial/inputoutput.html" title="Python documentation">Python documentation</a>).</p>

<p>This last piece of code read the GIF2 galaxy catalogue (an ASCII file with &ldquo;space separated values&rdquo;):</p>

<pre><code class="language-python">#! /usr/bin/env python

file = open('lcdm_galaxy_cat.z0.00', 'rb')
i = 0
for riga in file.readlines():
    parole = riga.split()
    if len(parole) == 11:
        print &quot;iterazione &quot;, i 
        print &quot;aggiungo &quot;
        x.append(parole[5])
        y.append(parole[6])
        z.append(parole[7])
    i+=1
</code></pre>

	
			
		    	<div class="social-sharing">
	<a class="share-button-facebook" onClick="return popupShare(this.href);" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fbrunettoziosi.eu%2fposts%2fgif2-files-python-reader%2f" target="_blank"><i class="fa fa-facebook"><span>Like</span></i></a>
	<a class="share-button-google-plus" onClick="return popupShare(this.href);" href="https://plus.google.com/share?url=http%3a%2f%2fbrunettoziosi.eu%2fposts%2fgif2-files-python-reader%2f" target="_blank"><i class="fa fa-google-plus"><span>Google +1</span></i></a>
	<a class="share-button-linkedin" onClick="return popupShare(this.href);" href="http://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2fbrunettoziosi.eu%2fposts%2fgif2-files-python-reader%2f&title=GIF2%20files%20Python%20reader&summary=I%20create%20this%20script%20on%20the%20basis%20of%20the%20code%20to%20read%20the%20Millennium%20II%20data%20%28the%20same%20used%20here%29%20provided%20by%20Mike%20Boylan-Kolchin.%20Being%20allowed%20to%20read%20the%20Fortran%20code%20to%20write%20and%20read%20the%20GIF2%20files%20I%20could%20adapt%20this%20script%20to%20exactly%20fit%20this%20problem.%20import%20numpy%20as%20np%20import%20sys%20class%20head%3a%20def%20__init__%28self%2c%20fname%29%3a%20import%20types%20bo_mark%3d%27%26gt%3b%27%20%23%20start%20by%20reading%20in%20header%3a%20if%20type%28fname%29%20is%20types.StringType%3a%20f%3dopen%28fname%2c%20%27rb%27%29%20elif%20type%28fname%29%20is%20not%20types.FileType%3a%20raise%20TypeError%28%27argument%20must%20either%20be%20an%20open%20file%20or%20%27%20%2b%20%27a%20string%20containing%20a%20file%20name%27%29%20else%3a%20f%3dfname%20After%20the%20usual%20imports%20we%20define%20a%20class%20to%20read%20and%20contain%20the%20file%20header.}&source=Post%20It%21" target="_blank"><i class="fa fa-linkedin"><span>Share on LinkedIn</span></i></a>
	<a class="share-button-twitter" onClick="return popupShare(this.href);" href="http://twitter.com/share?text=GIF2%20files%20Python%20reader&url=http%3a%2f%2fbrunettoziosi.eu%2fposts%2fgif2-files-python-reader%2f" target="_blank"><i class="fa fa-twitter"><span>Tweet</span></i></a>	
</div>
		    

			
				<div class="tags-list">
					<span class="dark-red">Tags</span><span class="decorative-marker">//</span>
					
	                <a class="post-tag post-tag-astro/physics" href="http://brunettoziosi.eu/tags/astro/physics">astro/physics</a>,
	                
	                <a class="post-tag post-tag-python" href="http://brunettoziosi.eu/tags/python">python</a>,
	                
	                <a class="post-tag post-tag-programming" href="http://brunettoziosi.eu/tags/programming">programming</a>,
	                
	                <a class="post-tag post-tag-phd" href="http://brunettoziosi.eu/tags/phd">PhD</a>,
	                
				</div>
			

			
				<div class="paging">
					<span class="paging-label">More Reading</span>
					
					<div class="paging-newer">
						<span class="dark-red">Newer</span><span class="decorative-marker">//</span>
						<a class="paging-link" href="/posts/my-first-gadget2-tests/">My first Gadget2 tests</a>
		            </div>
		            

					
					<div class="paging-older">
						<span class="dark-red">Older</span><span class="decorative-marker">//</span>
			            <a class="paging-link" href="/posts/gif2-substructures-coordinates-correction/">GIF2 substructures coordinates correction</a>
		            </div>
		            
	            </div>
            
          </section>
          

          	<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = "brunettoziosieu";   
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

          
        
      <div class="footer">
	<hr class="thin" />
	<div class="pure-menu pure-menu-horizontal pure-menu-open">
		<ul class="footer-menu">
		
		</ul>
	</div>
	<p>&copy; 2015 
	<a href="https://plus.google.com/117554238100031566866?rel=author">Brunetto Ziosi</a>. All rights reserved. </br>
	Theme by <a href="https://github.com/tmaiaroto/hugo-redlounge">Tom Maiaroto</a>, Generated (with ‚ù§) using <a href="http://gohugo.io/">Hugo.</a></p>
</div>

    </div>
  </div>
	

	
		<script type="text/javascript">
			function popupShare(url) {
				window.open(url, '_blank', 'scrollbars,resizable,height=525,width=600');
				return false;
			}
		</script>
	

  
  <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML&delayStartupUntil=configured" type="text/javascript"></script>
    <script type="text/javascript">
    
    MathJax.Hub.Config({
      tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
      extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js"]
      }
    });
    MathJax.Hub.Queue(function() {
      $(MathJax.Hub.getAllJax()).map(function(index, elem) {
        return(elem.SourceElement());
      }).parent().addClass('has-jax');
    });
    MathJax.Hub.Configured();
    </script>
</body>
</html>
