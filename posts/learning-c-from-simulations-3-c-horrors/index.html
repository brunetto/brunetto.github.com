<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <title>
    Learning C from simulations, #3: C horrors! // Post It!
  </title>

  <link href="http://gmpg.org/xfn/11" rel="profile">
<meta http-equiv="content-type" content="text/html; charset=utf-8">


<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

<meta name="description" content="">
<meta name="keywords" content="">
<meta name="author" content="Brunetto Ziosi">

  <meta property="og:title" content="Learning C from simulations, #3: C horrors!" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:locale" content="en_US" />
<meta property="og:url" content="http://brunettoziosi.eu/posts/learning-c-from-simulations-3-c-horrors/" />


  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/base-min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/pure-min.css">
  
  
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/grids-responsive-min.css">
  
  

  <link rel="stylesheet" href="http://brunettoziosi.eu/css/redlounge.css">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
  <link href='//fonts.googleapis.com/css?family=Raleway:400,200,100,700,300,500,600,800' rel='stylesheet' type='text/css'>
  <link href='//fonts.googleapis.com/css?family=Libre+Baskerville:400,700,400italic' rel='stylesheet' type='text/css'>

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  <link href="" rel="alternate" type="application/rss+xml" title="Post It!" />

    
  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/tomorrow-night-bright.min.css">
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>


  

  

  
</head>

<body>
	

	<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
  <div class="header">
    

    <h1 class="brand-title">Post It!</h1>
    <h2 class="brand-tagline">Sticky digital notes stuck on the Net!;D</h2>

    <nav class="nav">
      <ul class="nav-list">
        <li class="nav-item"><span class="nav-item-separator">//</span><a href="http://brunettoziosi.eu">Home</a></li>
        
          <li class="nav-item"><span class="nav-item-separator">//</span><a href="/posts/">Blog</a></li>
        
          <li class="nav-item"><span class="nav-item-separator">//</span><a href="/pages/">Pages</a></li>
        
      </ul>
    </nav>

    
    <div class="social-buttons">
      
        
        <a href="http://plus.google.com/&#43;BrunettoZiosi" target="_blank"><i class='fa fa-google-plus'></i></a>
        
      
        
        <a href="http://www.linkedin.com/in/brunettoziosi" target="_blank"><i class='fa fa-linkedin'></i></a>
        
      
        
        <a href="http://www.github.com/brunetto" target="_blank"><i class='fa fa-github'></i></a>
        
      
        
        <a href="http://www.facebook.com/brunettoziosi" target="_blank"><i class='fa fa-facebook'></i></a>
        
      
        
        <a href="http://www.twitter.com/brunettoziosi" target="_blank"><i class='fa fa-twitter'></i></a>
        
      
      
    </div>
    

  </div>
</div>

	
	

    <div class="content pure-u-1 pure-u-md-3-4">
		<a name="top"></a>
		

		
			
	    
  		<section class="post">
            <h1 class="post-title">
              <a href="/posts/learning-c-from-simulations-3-c-horrors/">Learning C from simulations, #3: C horrors!</a>
            </h1>
            <h3 class="post-subtitle">
            	
            </h3>
            
            	<span class="post-date">
                	<span class="post-date-day"><sup>20</sup></span><span class="post-date-separator">/</span><span class="post-date-month">Feb</span> <span class="post-date-year">2012</span>
            	</span>
            	
            
            	
            		<span class="post-author-single">By <a class="post-author" href="http://brunettoziosi.eu" target="">Brunetto Ziosi</a></span>
            		




            	
            

			
			
				<div class="post-categories">
				
					<a class="post-category post-category-research" href="http://brunettoziosi.eu/categories/research">Research</a>
				
					<a class="post-category post-category-programming" href="http://brunettoziosi.eu/categories/programming">Programming</a>
				
					<a class="post-category post-category-post" href="http://brunettoziosi.eu/categories/post">Post</a>
				
				</div>
			

			
		    	<div class="social-sharing">
	<a class="share-button-facebook" onClick="return popupShare(this.href);" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fbrunettoziosi.eu%2fposts%2flearning-c-from-simulations-3-c-horrors%2f" target="_blank"><i class="fa fa-facebook"><span>Like</span></i></a>
	<a class="share-button-google-plus" onClick="return popupShare(this.href);" href="https://plus.google.com/share?url=http%3a%2f%2fbrunettoziosi.eu%2fposts%2flearning-c-from-simulations-3-c-horrors%2f" target="_blank"><i class="fa fa-google-plus"><span>Google +1</span></i></a>
	<a class="share-button-linkedin" onClick="return popupShare(this.href);" href="http://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2fbrunettoziosi.eu%2fposts%2flearning-c-from-simulations-3-c-horrors%2f&title=Learning%20C%20from%20simulations%2c%20%233%3a%20C%20horrors%21&summary=Yeah%2c%20this%20is%20post%20%233%21%20Post%20%232%20is%20%26ldquo%3bwork%20in%20progress%26rdquo%3b%20and%20it%20will%20be%20on%20FFTs%21%20Today%20I%20was%20trying%20to%20understand%20what%20this%20piece%20of%20code%20do%3a%20for%28i%20%3d%200%3b%20i%20%26lt%3b%20Nmesh%20%2f%202%3b%20i%2b%2b%29%20%7b%20for%28j%20%3d%200%3b%20j%20%26lt%3b%20i%3b%20j%2b%2b%29%20seedtable%5bi%20%2a%20Nmesh%20%2b%20j%5d%20%3d%200x7fffffff%20%2a%20gsl_rng_uniform%28random_generator%29%3b%20for%28j%20%3d%200%3b%20j%20%26lt%3b%20i%20%2b%201%3b%20j%2b%2b%29%20seedtable%5bj%20%2a%20Nmesh%20%2b%20i%5d%20%3d%200x7fffffff%20%2a%20gsl_rng_uniform%28random_generator%29%3b%20for%28j%20%3d%200%3b%20j%20%26lt%3b%20i%3b%20j%2b%2b%29%20seedtable%5b%28Nmesh%20-%201%20-%20i%29%20%2a%20Nmesh%20%2b%20j%5d%20%3d%200x7fffffff%20%2a%20gsl_rng_uniform%28random_generator%29%3b%20for%28j%20%3d%200%3b%20j%20%26lt%3b%20i%20%2b%201%3b%20j%2b%2b%29%20seedtable%5b%28Nmesh%20-%201%20-%20j%29%20%2a%20Nmesh%20%2b%20i%5d%20%3d%200x7fffffff%20%2a%20gsl_rng_uniform%28random_generator%29%3b%20for%28j%20%3d%200%3b%20j%20%26lt%3b%20i%3b%20j%2b%2b%29%20seedtable%5bi%20%2a%20Nmesh%20%2b%20%28Nmesh%20-%201%20-%20j%29%5d%20%3d%200x7fffffff%20%2a%20gsl_rng_uniform%28random_generator%29%3b%20for%28j%20%3d%200%3b%20j%20%26lt%3b%20i%20%2b%201%3b%20j%2b%2b%29%20seedtable%5bj%20%2a%20Nmesh%20%2b%20%28Nmesh%20-%201%20-%20i%29%5d%20%3d%200x7fffffff%20%2a%20gsl_rng_uniform%28random_generator%29%3b%20for%28j%20%3d%200%3b%20j%20%26lt%3b%20i%3b%20j%2b%2b%29%20seedtable%5b%28Nmesh%20-%201%20-%20i%29%20%2a%20Nmesh%20%2b%20%28Nmesh%20-%201%20-%20j%29%5d%20%3d%200x7fffffff%20%2a%20gsl_rng_uniform%28random_generator%29%3b%20for%28j%20%3d%200%3b%20j%20%26lt%3b%20i%20%2b%201%3b%20j%2b%2b%29%20seedtable%5b%28Nmesh%20-%201%20-%20j%29%20%2a%20Nmesh%20%2b%20%28Nmesh%20-%201%20-%20i%29%5d%20%3d%200x7fffffff%20%2a%20gsl_rng_uniform%28random_generator%29%3b%20%7d%20It%26rsquo%3bs%20a%20piece%20of%20the%20source%20of%20N-GenIC%2c%20Springel%26rsquo%3bs%20ICs%20generator%20for%20Gadget2.}&source=Post%20It%21" target="_blank"><i class="fa fa-linkedin"><span>Share on LinkedIn</span></i></a>
	<a class="share-button-twitter" onClick="return popupShare(this.href);" href="http://twitter.com/share?text=Learning%20C%20from%20simulations%2c%20%233%3a%20C%20horrors%21&url=http%3a%2f%2fbrunettoziosi.eu%2fposts%2flearning-c-from-simulations-3-c-horrors%2f" target="_blank"><i class="fa fa-twitter"><span>Tweet</span></i></a>	
</div>
		    

			

            <p>Yeah, this is post #3! Post #2 is &ldquo;work in progress&rdquo; and it will be on FFTs!</p>

<p>Today I was trying to understand what this piece of code do:</p>

<pre><code class="language-c">for(i = 0; i &lt; Nmesh / 2; i++)
    {
      for(j = 0; j &lt; i; j++)
 seedtable[i * Nmesh + j] = 0x7fffffff * gsl_rng_uniform(random_generator);

      for(j = 0; j &lt; i + 1; j++)
 seedtable[j * Nmesh + i] = 0x7fffffff * gsl_rng_uniform(random_generator);

      for(j = 0; j &lt; i; j++)
 seedtable[(Nmesh - 1 - i) * Nmesh + j] = 0x7fffffff * gsl_rng_uniform(random_generator);

      for(j = 0; j &lt; i + 1; j++)
 seedtable[(Nmesh - 1 - j) * Nmesh + i] = 0x7fffffff * gsl_rng_uniform(random_generator);

      for(j = 0; j &lt; i; j++)
 seedtable[i * Nmesh + (Nmesh - 1 - j)] = 0x7fffffff * gsl_rng_uniform(random_generator);

      for(j = 0; j &lt; i + 1; j++)
 seedtable[j * Nmesh + (Nmesh - 1 - i)] = 0x7fffffff * gsl_rng_uniform(random_generator);

      for(j = 0; j &lt; i; j++)
 seedtable[(Nmesh - 1 - i) * Nmesh + (Nmesh - 1 - j)] = 0x7fffffff * gsl_rng_uniform(random_generator);

      for(j = 0; j &lt; i + 1; j++)
 seedtable[(Nmesh - 1 - j) * Nmesh + (Nmesh - 1 - i)] = 0x7fffffff * gsl_rng_uniform(random_generator);
    }
</code></pre>

<!-- TEASER_END -->    

<p>It&rsquo;s a piece of the source of N-GenIC, Springel&rsquo;s ICs generator for <a href="http://www.gadgetcode.org/right.html" target="_blank" title="Gadget2">Gadget2</a>. Obviously no comments were present and I have no experience of how those codes work. I know that this is a way to fill the <code>seedtable</code> array, maybe a matrix that provides random seeds for the FFTs or to generate the [latex]delta[/latex]s for the realization of the density field. This array is stored in 1D so to access the elements we have to do some magic with indices. Trying to understand how the matrix is filled and how the indices works, and to practice with C I&rsquo;ve wrote this piece of code:</p>

<pre><code class="language-c">#include &lt;stdio.h&gt;
#include &lt;math.h&gt;

int i = 0, j = 0;
int N = 10;

int main(int argc, char **argv){
  for(i = 0; i &lt; N/2; i++){
    printf(&quot;i = %in&quot;, i);
    for(j = 0; j &lt; i; j++)
      printf(&quot;t j= %in&quot;, j);
      if(!(i * N + j))
 printf(&quot;j doesn't existn&quot;);
      printf(&quot;tt i * Nmesh + j = %in&quot;,  i * N + j);
  /*
    a lot of commented code from the code above
  */
  }
  return 0;
}
</code></pre>

<p>The result was</p>

<pre><code class="language-bash">i = 0
j doesn't exist
                 i * Nmesh + j = 0
i = 1
         j= 0
                 i * Nmesh + j = 11
i = 2
         j= 0
         j= 1
                 i * Nmesh + j = 22
i = 3
         j= 0
         j= 1
         j= 2
                 i * Nmesh + j = 33
i = 4
         j= 0
         j= 1
         j= 2
         j= 3
                 i * Nmesh + j = 44
</code></pre>

<p>clearly wrong.<br />
So I&rsquo;ve modified the code (thanks to my coworker) to print <code>j</code> and the expression in both the lines, and the result was</p>

<pre><code class="language-c">i = 0
j doesn't exist
         j= 0, i * Nmesh + j = 0
i = 1
         j= 0, i * Nmesh + j = 10
         j= 1, i * Nmesh + j = 11
i = 2
         j= 0, i * Nmesh + j = 20
         j= 1, i * Nmesh + j = 21
         j= 2, i * Nmesh + j = 22
i = 3
         j= 0, i * Nmesh + j = 30
         j= 1, i * Nmesh + j = 31
         j= 2, i * Nmesh + j = 32
         j= 3, i * Nmesh + j = 33
i = 4
         j= 0, i * Nmesh + j = 40
         j= 1, i * Nmesh + j = 41
         j= 2, i * Nmesh + j = 42
         j= 3, i * Nmesh + j = 43
         j= 4, i * Nmesh + j = 44
</code></pre>

<p>wrong again!</p>

<p>The key is the second <code>for</code> statement, without the brackets. It was difficult to me to see this because C allows a for statement without brackets evaluating only the first line into the loop, and there were a lot of loop of one line commented into the code. The correct code</p>

<pre><code class="language-c">#include &lt;stdio.h&gt;
#include &lt;math.h&gt;

int i = 0, j = 0;
int N = 10;

int main(int argc, char **argv){
  for(i = 0; i &lt; N/2; i++){
    printf(&quot;i = %in&quot;, i);
    for(j = 0; j &lt; i; j++){
      printf(&quot;t j= %i, i * Nmesh + j = %in&quot;, j, i * N + j);
      if(!(i * N + j))
 printf(&quot;j doesn't existn&quot;);
      printf(&quot;t j= %i, i * Nmesh + j = %in&quot;, j, i * N + j);
  /*
    a lot of commented code from the code above
  */
    }
  }
  return 0;
}
</code></pre>

<p>works right!<br />
Obviously the Python version I&rsquo;ve wrote before was perfect the first time I wrote it.!:P In Python, due to the mandatory indentation (and without those terrible brackets!:P) it&rsquo;s straightforward to understand what belong to a loop and what doesn&rsquo;t!</p>

	
			
		    	<div class="social-sharing">
	<a class="share-button-facebook" onClick="return popupShare(this.href);" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fbrunettoziosi.eu%2fposts%2flearning-c-from-simulations-3-c-horrors%2f" target="_blank"><i class="fa fa-facebook"><span>Like</span></i></a>
	<a class="share-button-google-plus" onClick="return popupShare(this.href);" href="https://plus.google.com/share?url=http%3a%2f%2fbrunettoziosi.eu%2fposts%2flearning-c-from-simulations-3-c-horrors%2f" target="_blank"><i class="fa fa-google-plus"><span>Google +1</span></i></a>
	<a class="share-button-linkedin" onClick="return popupShare(this.href);" href="http://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2fbrunettoziosi.eu%2fposts%2flearning-c-from-simulations-3-c-horrors%2f&title=Learning%20C%20from%20simulations%2c%20%233%3a%20C%20horrors%21&summary=Yeah%2c%20this%20is%20post%20%233%21%20Post%20%232%20is%20%26ldquo%3bwork%20in%20progress%26rdquo%3b%20and%20it%20will%20be%20on%20FFTs%21%20Today%20I%20was%20trying%20to%20understand%20what%20this%20piece%20of%20code%20do%3a%20for%28i%20%3d%200%3b%20i%20%26lt%3b%20Nmesh%20%2f%202%3b%20i%2b%2b%29%20%7b%20for%28j%20%3d%200%3b%20j%20%26lt%3b%20i%3b%20j%2b%2b%29%20seedtable%5bi%20%2a%20Nmesh%20%2b%20j%5d%20%3d%200x7fffffff%20%2a%20gsl_rng_uniform%28random_generator%29%3b%20for%28j%20%3d%200%3b%20j%20%26lt%3b%20i%20%2b%201%3b%20j%2b%2b%29%20seedtable%5bj%20%2a%20Nmesh%20%2b%20i%5d%20%3d%200x7fffffff%20%2a%20gsl_rng_uniform%28random_generator%29%3b%20for%28j%20%3d%200%3b%20j%20%26lt%3b%20i%3b%20j%2b%2b%29%20seedtable%5b%28Nmesh%20-%201%20-%20i%29%20%2a%20Nmesh%20%2b%20j%5d%20%3d%200x7fffffff%20%2a%20gsl_rng_uniform%28random_generator%29%3b%20for%28j%20%3d%200%3b%20j%20%26lt%3b%20i%20%2b%201%3b%20j%2b%2b%29%20seedtable%5b%28Nmesh%20-%201%20-%20j%29%20%2a%20Nmesh%20%2b%20i%5d%20%3d%200x7fffffff%20%2a%20gsl_rng_uniform%28random_generator%29%3b%20for%28j%20%3d%200%3b%20j%20%26lt%3b%20i%3b%20j%2b%2b%29%20seedtable%5bi%20%2a%20Nmesh%20%2b%20%28Nmesh%20-%201%20-%20j%29%5d%20%3d%200x7fffffff%20%2a%20gsl_rng_uniform%28random_generator%29%3b%20for%28j%20%3d%200%3b%20j%20%26lt%3b%20i%20%2b%201%3b%20j%2b%2b%29%20seedtable%5bj%20%2a%20Nmesh%20%2b%20%28Nmesh%20-%201%20-%20i%29%5d%20%3d%200x7fffffff%20%2a%20gsl_rng_uniform%28random_generator%29%3b%20for%28j%20%3d%200%3b%20j%20%26lt%3b%20i%3b%20j%2b%2b%29%20seedtable%5b%28Nmesh%20-%201%20-%20i%29%20%2a%20Nmesh%20%2b%20%28Nmesh%20-%201%20-%20j%29%5d%20%3d%200x7fffffff%20%2a%20gsl_rng_uniform%28random_generator%29%3b%20for%28j%20%3d%200%3b%20j%20%26lt%3b%20i%20%2b%201%3b%20j%2b%2b%29%20seedtable%5b%28Nmesh%20-%201%20-%20j%29%20%2a%20Nmesh%20%2b%20%28Nmesh%20-%201%20-%20i%29%5d%20%3d%200x7fffffff%20%2a%20gsl_rng_uniform%28random_generator%29%3b%20%7d%20It%26rsquo%3bs%20a%20piece%20of%20the%20source%20of%20N-GenIC%2c%20Springel%26rsquo%3bs%20ICs%20generator%20for%20Gadget2.}&source=Post%20It%21" target="_blank"><i class="fa fa-linkedin"><span>Share on LinkedIn</span></i></a>
	<a class="share-button-twitter" onClick="return popupShare(this.href);" href="http://twitter.com/share?text=Learning%20C%20from%20simulations%2c%20%233%3a%20C%20horrors%21&url=http%3a%2f%2fbrunettoziosi.eu%2fposts%2flearning-c-from-simulations-3-c-horrors%2f" target="_blank"><i class="fa fa-twitter"><span>Tweet</span></i></a>	
</div>
		    

			
				<div class="tags-list">
					<span class="dark-red">Tags</span><span class="decorative-marker">//</span>
					
	                <a class="post-tag post-tag-c" href="http://brunettoziosi.eu/tags/c">c</a>,
	                
	                <a class="post-tag post-tag-n-body" href="http://brunettoziosi.eu/tags/n-body">N-body</a>,
	                
	                <a class="post-tag post-tag-numerical" href="http://brunettoziosi.eu/tags/numerical">numerical</a>,
	                
	                <a class="post-tag post-tag-simulations" href="http://brunettoziosi.eu/tags/simulations">simulations</a>,
	                
	                <a class="post-tag post-tag-phd" href="http://brunettoziosi.eu/tags/phd">phd</a>,
	                
				</div>
			

			
				<div class="paging">
					<span class="paging-label">More Reading</span>
					
					<div class="paging-newer">
						<span class="dark-red">Newer</span><span class="decorative-marker">//</span>
						<a class="paging-link" href="/posts/learning-c-from-simulations-1/">Learning C from simulations, #1</a>
		            </div>
		            

					
					<div class="paging-older">
						<span class="dark-red">Older</span><span class="decorative-marker">//</span>
			            <a class="paging-link" href="/posts/the-initial-condition-saga/">The initial condition saga</a>
		            </div>
		            
	            </div>
            
          </section>
          
          	
          
        
      <div class="footer">
	<hr class="thin" />
	<div class="pure-menu pure-menu-horizontal pure-menu-open">
		<ul class="footer-menu">
		
		</ul>
	</div>
	<p>&copy; 2015 
	<a href="https://plus.google.com/117554238100031566866?rel=author">Brunetto Ziosi</a>. All rights reserved. </br>
	Theme by <a href="https://github.com/tmaiaroto/hugo-redlounge">Tom Maiaroto</a></p>
</div>
    </div>
  </div>
	

	
		<script type="text/javascript">
			function popupShare(url) {
				window.open(url, '_blank', 'scrollbars,resizable,height=525,width=600');
				return false;
			}
		</script>
	

  
  <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML&delayStartupUntil=configured" type="text/javascript"></script>
    <script type="text/javascript">
    
    MathJax.Hub.Config({
      tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
      extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js"]
      }
    });
    MathJax.Hub.Queue(function() {
      $(MathJax.Hub.getAllJax()).map(function(index, elem) {
        return(elem.SourceElement());
      }).parent().addClass('has-jax');
    });
    MathJax.Hub.Configured();
    </script>
</body>
</html>