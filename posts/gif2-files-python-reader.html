<!DOCTYPE html><html lang="en">
<head>
    
    <meta charset="utf-8">
    <meta name="description" content="">
    <meta name="author" content="brunetto">
    <title>GIF2 files Python reader | brunetto's blog</title>
    <!-- mathjax_config -->
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
        },
        displayAlign: 'left', // Change this to 'center' to center equations.
        "HTML-CSS": {
            styles: {'.MathJax_Display': {"margin": 0}}
        }
    });
    </script>
    
        
            <link href="../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
            <link href="../assets/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css">
        
        <link href="../assets/css/rst.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/code.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/colorbox.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/theme.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
        
    
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]-->
    
        
            <link rel="alternate" type="application/rss+xml" title="RSS" href="../rss.xml">
        
    
    

    


    


    
</head>
<body>
<!-- Menubar -->
<div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">

        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </a>

            <a class="brand" href="../">
            brunetto's blog
            </a>
            <!-- Everything you want hidden at 940px or less, place within here -->
            <div class="nav-collapse collapse">
                <ul class="nav">
                    
    
        
            <li><a href="../archive.html">Archives</a>
        
    
        
            </li><li><a href="../categories/index.html">Tags</a>
        
    
        
            </li><li><a href="../stories/about.html">About</a>
        
    
        
            </li><li><a href="../rss.xml">RSS</a>
        
    

                </li></ul>
                
                    
<!-- Custom search with google-->
<form id="search" action="http://google.com/search" method="get" class="navbar-form pull-left">
<input type="hidden" name="q" value="site:brunetto.github.io">
<input type="text" name="q" maxlength="255" results="0" placeholder="Search">
</form>
<!-- End of custom search -->

                
                <ul class="nav pull-right">
                
                
                
                
                </ul>
            </div>
        </div>
    </div>
</div>
<!-- End of Menubar -->
<div class="container-fluid" id="container-fluid">
    <!--Body content-->
    <div class="row-fluid">
    <div class="span2"></div>
    <div class="span8">
    
    <div class="postbox">
    
    <h1>GIF2 files Python reader</h1>
    

    <hr>
    <small>
        Posted: <time class="published" datetime="2011-12-06T00:00:00">2011-12-06 00:00</time>
        
    

        
    
          |  More posts about
        
            <a class="tag" href="../categories/astrophysics.html"><span class="badge badge-info">astro/physics</span></a>
        
            <a class="tag" href="../categories/cosmology.html"><span class="badge badge-info">Cosmology</span></a>
        
            <a class="tag" href="../categories/master-thesis.html"><span class="badge badge-info">Master Thesis</span></a>
        
            <a class="tag" href="../categories/millennium.html"><span class="badge badge-info">millennium</span></a>
        
            <a class="tag" href="../categories/n-body.html"><span class="badge badge-info">N-body</span></a>
        
            <a class="tag" href="../categories/python.html"><span class="badge badge-info">Python</span></a>
        
            <a class="tag" href="../categories/simulation.html"><span class="badge badge-info">simulation</span></a>
        
            <a class="tag" href="../categories/imported.html"><span class="badge badge-info">imported</span></a>
        
    

    </small>
    <hr>
    <p>I create this script on the basis of the code to read the Millennium II data (the same used <a href="http://elbrunz.wordpress.com/2011/12/02/from-binaries-to-hdf5-using-python/" title="From binaries to HDF5 using Python">here</a>) provided by <a href="http://mbk.ps.uci.edu/index.html" title="Mike Boylan-Kolchin">Mike Boylan-Kolchin</a>. Being allowed to read the Fortran code to write and read the GIF2 files I could adapt this script to exactly fit this problem.    </p>
<!-- TEASER_END-->

<div class="code"><pre>
</pre></div>


<div class="code"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">class</span> <span class="nc">head</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">types</span>
        <span class="n">bo_mark</span><span class="o">=</span><span class="s">'&gt;'</span>
        <span class="c"># start by reading in header:    </span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="ow">is</span> <span class="n">types</span><span class="o">.</span><span class="n">StringType</span><span class="p">:</span>
            <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s">'rb'</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">types</span><span class="o">.</span><span class="n">FileType</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">'argument must either be an open file or '</span> <span class="o">+</span> 
                            <span class="s">'a string containing a file name'</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span><span class="o">=</span><span class="n">fname</span>
</pre></div>


<p>After the usual imports we define a class to read and contain the file header. These first lines check the "filename" argument.    </p>
<div class="code"><pre><span class="bp">self</span><span class="o">.</span><span class="n">pad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bo_mark</span><span class="o">+</span><span class="s">'i4'</span><span class="p">)</span>
</pre></div>


<p>In the unformatted Fortran binary files the "pad" is a 4-byte space to separate the values of different quantities in the file. <code>bo_mark</code> contains the endianess ("bo" means byte order) of the system allowing Python to correctly interpret the numbers from the binary file. <code>count</code> sets the number of item of type <code>dtype</code> to be read. For example <code>count=3</code> and <code>dtype=bo_mark+'i4'</code> will store three 4-byte integer in the variable, with the byte order expressed by <code>bo_mark</code>, <code>&lt;</code> for big-endian, <code>&gt;</code> for little-endian.    </p>
<div class="code"><pre><span class="c"># npart is an array containing the number of particles in the</span>
        <span class="c"># file divided by type (gas, ...)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">npart</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bo_mark</span><span class="o">+</span><span class="s">'i4'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">massarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bo_mark</span><span class="o">+</span><span class="s">'f8'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aaa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bo_mark</span><span class="o">+</span><span class="s">'f8'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redshift</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bo_mark</span><span class="o">+</span><span class="s">'f8'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flag_sfr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bo_mark</span><span class="o">+</span><span class="s">'i4'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flag_feedback</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bo_mark</span><span class="o">+</span><span class="s">'i4'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nall</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bo_mark</span><span class="o">+</span><span class="s">'i4'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cooling_flag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bo_mark</span><span class="o">+</span><span class="s">'i4'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numfiles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bo_mark</span><span class="o">+</span><span class="s">'i4'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boxsize</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bo_mark</span><span class="o">+</span><span class="s">'f8'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Omega</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bo_mark</span><span class="o">+</span><span class="s">'f8'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OmegaL0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bo_mark</span><span class="o">+</span><span class="s">'f8'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Hubblepar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bo_mark</span><span class="o">+</span><span class="s">'f8'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bo_mark</span><span class="o">+</span><span class="s">'a96'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pad2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bo_mark</span><span class="o">+</span><span class="s">'i4'</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="ow">is</span> <span class="n">types</span><span class="o">.</span><span class="n">StringType</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>


<p>These lines read and store the values of the quantities saved in the header of the file.    </p>
<div class="code"><pre><span class="k">def</span> <span class="nf">read_gif2_file</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
    <span class="n">bo_mark</span> <span class="o">=</span> <span class="s">'&gt;'</span>
    <span class="n">f</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s">'rb'</span><span class="p">)</span>
    <span class="c"># start by reading in header:    </span>
    <span class="n">ghead</span><span class="o">=</span><span class="n">head</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">npt</span><span class="o">=</span><span class="n">ghead</span><span class="o">.</span><span class="n">npart</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="sb">````</span>

<span class="n">This</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">function</span> <span class="n">we</span> <span class="n">use</span> <span class="n">to</span> <span class="n">read</span> <span class="n">the</span> <span class="n">files</span><span class="p">:</span> <span class="n">it</span> <span class="nb">set</span> <span class="n">the</span> <span class="n">endianness</span> <span class="n">to</span> <span class="s">"big-endian"</span><span class="p">,</span> <span class="nb">open</span> <span class="n">the</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">read</span><span class="o">-</span><span class="n">only</span> <span class="n">mode</span><span class="p">,</span> <span class="n">read</span> <span class="n">the</span> <span class="n">header</span> <span class="ow">and</span> <span class="n">extract</span> <span class="n">the</span> <span class="n">total</span> <span class="n">number</span> <span class="n">of</span> <span class="n">particles</span><span class="o">.</span>    
<span class="sb">````</span><span class="n">python</span>
<span class="n">f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">pos</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="n">npt</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">bo_mark</span> <span class="o">+</span> <span class="s">'f4'</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">npt</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">pos</span>
</pre></div>


<p><code>f.seek(offset, from_what)</code> move the pointer through the file to read bits from one position to another. The position is computed from adding <code>offset</code> to a reference point; the reference point is selected by the <code>from_what</code> argument. A <code>from_what</code> value of 0 measures from the beginning of the file, 1 uses the current file position, and 2 uses the end of the file as the reference point. <code>from_what</code> can be omitted and defaults to 0, using the beginning of the file as the reference point (from the <a href="http://docs.python.org/tutorial/inputoutput.html" title="Python documentation">Python documentation</a>).    </p>
<p>This last piece of code read the GIF2 galaxy catalogue (an ASCII file with "space separated values"):    </p>
<div class="code"><pre><span class="c">#! /usr/bin/env python</span>

<span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'lcdm_galaxy_cat.z0.00'</span><span class="p">,</span> <span class="s">'rb'</span><span class="p">)</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">riga</span> <span class="ow">in</span> <span class="nb">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
    <span class="n">parole</span> <span class="o">=</span> <span class="n">riga</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parole</span><span class="p">)</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">"iterazione "</span><span class="p">,</span> <span class="n">i</span> 
        <span class="k">print</span> <span class="s">"aggiungo "</span>
        <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parole</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
        <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parole</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
        <span class="n">z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parole</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
    <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
</pre></div>
    
    <ul class="pager">
    
        <li class="previous">
            <a href="cosmological-simulations-7-limitations-and-some-considerations.html">← Previous post</a>
        </li>
    
    
        <li class="next">
            <a href="my-first-gadget2-tests.html">Next post →</a>
        </li>
    
    </ul>

    
        
    
        <div id="disqus_thread"></div>
        <script type="text/javascript">
        var disqus_shortname ="brunettosblog";
        
            var disqus_url="brunetto.github.io/posts/gif2-files-python-reader.html";
        
        var disqus_title="GIF2 files Python reader";
        var disqus_identifier="cache/posts/gif2-files-python-reader.html";
        var disqus_config = function () {
            this.language = "";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">Comments powered by <span class="logo-disqus">Disqus</span></a>
    

    
    
    

    </div>

    </div>
    </div>
    <!--End of body content-->
</div>
<div class="footerbox">
    Contents © 2013         <a href="mailto:brunetto.ziosi@gmail.com">brunetto</a> - Powered by         <a href="http://nikola.ralsina.com.ar">Nikola</a>
</div>


    <!-- Social buttons -->
    <div id="addthisbox" class="addthis_toolbox addthis_peekaboo_style addthis_default_style addthis_label_style addthis_32x32_style">
    <a class="addthis_button_more">Share</a>
    <ul><li><a class="addthis_button_facebook"></a>
    </li><li><a class="addthis_button_google_plusone_share"></a>
    </li><li><a class="addthis_button_linkedin"></a>
    </li><li><a class="addthis_button_twitter"></a>
    </li></ul>
    </div>
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4f7088a56bb93798"></script>
    <!-- End of social buttons -->



    
        
            <script src="../assets/js/jquery-1.7.2.min.js" type="text/javascript"></script>
            <script src="../assets/js/bootstrap.min.js" type="text/javascript"></script>
        
        <script src="../assets/js/jquery.colorbox-min.js" type="text/javascript"></script>
        <script src="../assets/js/mathjax-onload.js" type="text/javascript"></script>
    


    <script type="text/javascript">jQuery("a.image-reference").colorbox({rel:"gal",maxWidth:"80%",maxHeight:"80%",scalePhotos:true});</script>
</body></html>