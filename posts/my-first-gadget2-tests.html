<!DOCTYPE html><html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta charset="utf-8">
    <meta name="author" content="brunetto">
    <title>My first Gadget2 tests | for future reference...</title>
    
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
   tex2jax: {
       inlineMath: [ ['$','$'], ["\\(","\\)"] ],
       displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
   },
   displayAlign: 'left', // Change this to 'center' to center equations.
   "HTML-CSS": {
       styles: {'.MathJax_Display': {"margin": 0}}
   }
});
</script>

            <link href="../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
            <link href="../assets/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/rst.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/code.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/colorbox.css" rel="stylesheet" type="text/css">
        <link href="../assets/css/theme.css" rel="stylesheet" type="text/css">
      <link rel="canonical" href="posts/my-first-gadget2-tests.html">
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]-->
            <link rel="alternate" type="application/rss+xml" title="RSS" href="../rss.xml">

    





    <link href="https://plus.google.com/117796240971605586205" rel="publisher">
</head>
<body>
<!-- Menubar -->
<div class="navbar navbar-fixed-top" id="navbar">
    <div class="navbar-inner">
        <div class="container">

        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </a>

            <a class="brand" href="brunettoziosi.eu">
            for future reference...
            </a>
            <!-- Everything you want hidden at 940px or less, place within here -->
            <div class="nav-collapse collapse">
                <ul class="nav">
                    
                <li><a href="../stories/about.html">About</a>
                </li><li><a href="../index.html">Blog</a>
                </li><li><a href="../stories/index.html">SiteIndex</a>
                </li><li><a href="../archive.html">Archives</a>
                </li><li><a href="../categories/index.html">Tags</a>
                </li><li><a href="../rss.xml">RSS</a>

                </li></ul>
                    
<!-- Custom search with google-->
<form id="search" action="http://google.com/search" method="get" class="navbar-form pull-left">
<input type="hidden" name="q" value="site:brunettoziosi.eu">
<input type="text" name="q" maxlength="255" results="0" placeholder="Search">
</form>
<!-- End of custom search -->

                <ul class="nav pull-right">
                
                
                </ul>
            </div>
        </div>
    </div>
</div>
<!-- End of Menubar -->
<div class="container-fluid" id="container-fluid">
    <!--Body content-->
    <div class="row-fluid">
    <div class="span2"></div>
    <div class="span8">
    
    <article class="postbox post-text">
    <div class="h-entry" itemscope="itemscope" itemtype="http://schema.org/Article">
    
    <h1 class="p-name" itemprop="headline name">My first Gadget2 tests</h1>

    <hr>
    <small>
        Posted: <time class="published dt-published" datetime="2012-01-07T00:00:00+00:00" itemprop="datePublished">2012-01-07 00:00</time>
        

		
          |  
        More posts about 
    <span itemprop="keywords">
        <a class="tag p-category" href="../categories/astrophysics.html"><span class="badge badge-info">astro/physics</span></a>
        <a class="tag p-category" href="../categories/code.html"><span class="badge badge-info">code</span></a>
        <a class="tag p-category" href="../categories/gadget2.html"><span class="badge badge-info">Gadget2</span></a>
        <a class="tag p-category" href="../categories/cosmology.html"><span class="badge badge-info">Cosmology</span></a>
        <a class="tag p-category" href="../categories/millennium.html"><span class="badge badge-info">millennium</span></a>
        <a class="tag p-category" href="../categories/n-body.html"><span class="badge badge-info">N-body</span></a>
        <a class="tag p-category" href="../categories/phd.html"><span class="badge badge-info">PhD</span></a>
        <a class="tag p-category" href="../categories/simulation.html"><span class="badge badge-info">simulation</span></a>
        <a class="tag p-category" href="../categories/imported.html"><span class="badge badge-info">imported</span></a>
    </span>


          |  
		
    </small>
    <hr>
    <div class="e-content" itemprop="articleBody text">
    <div><p>This post is about my first experience with the cosmological simulation code <a href="http://www.mpa-garching.mpg.de/gadget/" title="Gadget2">Gadget2</a>. To start I followed the instructions found <a href="http://astrobites.com/2011/04/02/installing-and-running-gadget-2/">here</a>. All I'm going to write refers to an Ubuntu/Kubuntu 11.10 installation.    </p>
<!-- TEASER_END -->

<div class="code"><pre>
</pre></div>


<p><strong>Installation of GSL and fftw</strong>    </p>
<p>We can download Gadget <a href="http://www.mpa-garching.mpg.de/gadget/" title="Gadget download">here</a>, the GSL (GNU scientific library) <a href="http://mirror.rit.edu/gnu/gsl/gsl-1.9.tar.gz" title="GSL download">here</a> and the FFTW (fastest Fourier transform in the West library) <a href="http://www.fftw.org/fftw-2.1.5.tar.gz" title="FFTW download">here</a>. We also need an MPI library (Open-MPI or MPICH, try install it using your package manager).  <br>
Following the Astrobites suggestions let's decompress the archives with <code>tar -xzf &amp;lt;archive name&amp;gt;</code>. Now we can install the libraries following the Astrobites post:    </p>
<div class="code"><pre>goldbaum@~/Documents/code: <span class="nb">cd </span>gsl-1.9/
goldbaum@~/Documents/code/gsl-1.9: ./configure
snip: lots of diagnostic ouput
goldbaum@~/Documents/code/gsl-1.9: make
snip: lots of compilation output
goldbaum@~/Documents/code/gsl-1.9: sudo make install
Password:
snip: lots of diagnostic output
goldbaum@~/Documents/code/gsl-1.9: <span class="nb">cd</span> ..
goldbaum@~/Documents/code: <span class="nb">cd </span>fftw-2.1.5
goldbaum@~/Documents/code/fftw-2.1.5: ./configure --enable-mpi --enable-type-prefix --enable-float
snip: lots of diagnostic output
goldbaum@~/Documents/code/gsl-1.9: make
snip: lots of compilation output
goldbaum@~/Documents/code/gsl-1.9: sudo make install
Password:
snip: lots of diagnostic output
goldbaum@~/Documents/code/gsl-1.9: <span class="nb">cd</span> ..
</pre></div>


<p>As described <a href="http://www.fftw.org/fftw2_doc/fftw_6.html#SEC69" target="_blank" title="FTTW installation and customization">here</a> is convenient to install both the single and the double precision version of the FFTW (for example to compile the initial conditions generators) with (that is, without <code>--enable-float</code>)    </p>
<div class="code"><pre>goldbaum@~/Documents/code: <span class="nb">cd </span>fftw-2.1.5
goldbaum@~/Documents/code/fftw-2.1.5: ./configure --enable-mpi --enable-type-prefix
snip: lots of diagnostic output
goldbaum@~/Documents/code/gsl-1.9: make
snip: lots of compilation output
goldbaum@~/Documents/code/gsl-1.9: sudo make install
Password:
snip: lots of diagnostic output
</pre></div>


<p><strong>Play with Gadget2</strong>    </p>
<p>Now it's time to play with Gadget!:) In this code, for performance reasons, requires to specify some parameters at compile time while other can be set at run time, so that we have to customize the Makefile. This also imply that we should have separate binary files and directories for each simulation.  <br>
To start with something easy, we will customize one of the examples given with the code, the "galaxy" one. It simulate the collision of two galaxies using 40000 DM particles for the haloes and 20000 baryonic particles for the disks.    </p>
<p>Inside the Gadget directory we have    </p>
<div class="code"><pre><span class="n">Analysis</span>
<span class="n">AUTHORS</span>
<span class="n">COPYING</span>
<span class="n">COPYRIGHT</span>
<span class="n">Documentation</span>
<span class="n">Gadget2</span>
<span class="n">ICs</span>
<span class="n">README</span>
</pre></div>


<p>In the <code>Analysis</code> folder we can fin some analysis routines provided by the author, the <code>Documentation</code> folder contains the user guide and the original paper, and the <code>AUTHORS, COPYING, COPYRIGHT</code> self-explanatory. The <code>ICs</code> folder contains the initial conditions for the example simulations and the <code>Gadget2</code> folder contains the sources and the html documentation.    </p>
<p>To be tidy and organized is better to have a folder for every simulations, so we will create a (descriptive) with everything we need to customize     </p>
<div class="code"><pre>mkdir 2012-01-07-Gadget2-galaxy_test_01
<span class="nb">cd </span>2012-01-07-Gadget2-galaxy_test_01
mkdir out
cp ../ICs/galaxy_littleendian.dat ./
cp ../Gadget2/parameterfiles/galaxy.param ../Gadget2/parameterfiles/galaxy.Makefile ./
</pre></div>


<p>In the folder Gadget2 we can find the general <code>Makefile</code> but for now let's use the galaxy's one provided by the author and just copied to our position. Open it with your preferred text editor (for example, in a command line environment, <code>emacs -nw Makefile</code>).  <br>
This <code>Makefile</code> is already customized for the galaxy collision simulation and if you want to understand every option you can read the description in the guide, but we need some more customization. Here what I've changed:    </p>
<div class="code"><pre>OPT   +<span class="o">=</span>  -DHAVE_HDF5  
</pre></div>


<p>so I activate the HDF5 format for the output and    </p>
<div class="code"><pre><span class="c">#--------------------------------------- Select target computer</span>

<span class="nv">SYSTYPE</span><span class="o">=</span><span class="s2">"Uno"</span>
<span class="se">\#</span><span class="nv">SYSTYPE</span><span class="o">=</span><span class="s2">"MPA"</span>
<span class="se">\#</span><span class="nv">SYSTYPE</span><span class="o">=</span><span class="s2">"Mako"</span>
<span class="se">\#</span><span class="nv">SYSTYPE</span><span class="o">=</span><span class="s2">"Regatta"</span>
<span class="se">\#</span><span class="nv">SYSTYPE</span><span class="o">=</span><span class="s2">"RZG_LinuxCluster"</span>
<span class="se">\#</span><span class="nv">SYSTYPE</span><span class="o">=</span><span class="s2">"RZG_LinuxCluster-gcc"</span>
<span class="se">\#</span><span class="nv">SYSTYPE</span><span class="o">=</span><span class="s2">"Opteron"</span>

<span class="se">\#</span>--------------------------------------- Adjust settings <span class="k">for </span>target computer

ifeq <span class="o">(</span><span class="k">$(</span>SYSTYPE<span class="k">)</span>,<span class="s2">"Uno"</span><span class="o">)</span>
<span class="nv">CC</span>       <span class="o">=</span>  mpicc   
<span class="nv">OPTIMIZE</span> <span class="o">=</span>  -O3 -Wall
<span class="nv">GSL_INCL</span> <span class="o">=</span>  -I/usr/local/include
<span class="nv">GSL_LIBS</span> <span class="o">=</span>  -L/usr/local/lib
<span class="nv">FFTW_INCL</span><span class="o">=</span>  -I/usr/local/include
<span class="nv">FFTW_LIBS</span><span class="o">=</span>  -L/usr/local/lib
<span class="nv">MPICHLIB</span> <span class="o">=</span>  -L/usr/lib
<span class="nv">HDF5INCL</span> <span class="o">=</span>  
<span class="nv">HDF5LIB</span>  <span class="o">=</span>  -lhdf5 -lz 
endif
</pre></div>


<p>to select the set the options for my system.  <br>
Now we have to customize the <code>run/galaxy.param</code> file changing it like this:    </p>
<div class="code"><pre>InitCondFile      ./galaxy_littleendian.dat
OutputDir          ./galaxy_out/
OutputListFilename ./out/output_list.txt
SnapFormat         3  %to <span class="k">select </span>the HDF5 format
TimeBegin           0.0        % Begin of the simulation
TimeMax             40.0        % End of the simulation

% Output frequency
TimeBetSnapshot        0.1% original 0.5 &lt;/pre&gt;


Now we should go to the sources folder and compile the code with    
&lt;pre&gt;cd ../Gadget2
make -f 2012-01-07-Gadget2-galaxy_test_01/galaxy.Makefile
cp Gadget2 ../2012-01-07-Gadget2-galaxy_test_01/Gadget2
make clean
<span class="nb">cd </span>2012-01-07-Gadget2-galaxy_test_01
</pre></div>


<p>The last command clean the build leaving only the sources files, so we are ready for a new build.  <br>
We can also create a script for automatize all this steps, something like:    </p>
<div class="code"><pre><span class="c">#!/bin/bash</span>
<span class="nv">dir</span><span class="o">=</span><span class="nv">$1</span>
<span class="nv">ics</span><span class="o">=</span><span class="nv">$2</span>
<span class="nv">param_file</span><span class="o">=</span><span class="nv">$3</span>
<span class="nv">mk_file</span><span class="o">=</span><span class="nv">$4</span>
<span class="nv">CPUs</span><span class="o">=</span><span class="nv">$5</span>

<span class="k">if</span> <span class="o">[</span> <span class="nv">$# </span>-lt 5 <span class="o">]</span> ; <span class="k">then</span>
<span class="k">  </span><span class="nb">echo</span> <span class="s2">"usage: gadget_set directory_name initial_conditions_file</span>
<span class="s2">parameters_file make_file number_of_CPUs"</span>
  <span class="nb">exit </span>0
<span class="k">fi</span>

<span class="nb">echo</span> <span class="s2">"Assuming to use $dir as the run folder,"</span> 
<span class="nb">echo</span> <span class="s2">"$ics as initial conditions,"</span>
<span class="nb">echo</span> <span class="s2">"$paramfile as parameter file, "</span>
<span class="nb">echo</span> <span class="s2">"$mk_file as makefile "</span>
<span class="nb">echo</span> <span class="s2">"and to run on $CPUs CPUs."</span>

mkdir <span class="nv">$dir</span>
<span class="nb">cd</span> <span class="nv">$dir</span>
mkdir out
cp ../ICs/<span class="nv">$ics</span> ./
cp ../Gadget2/parameterfiles/<span class="nv">$param_file</span>
../Gadget2/parameterfiles/mk_file ./
<span class="nb">cd</span> ../Gadget2
make -f ../<span class="nv">$dir</span>/<span class="nv">$mk_file</span>
cp Gadget2 ../<span class="nv">$dir</span>/Gadget2
make clean
<span class="nb">cd</span> <span class="nv">$dir</span>
mpirun -np <span class="nv">$CPUs</span> ./Gadget2 <span class="nv">$param_file</span>
</pre></div>


<p>This is a very raw and untested script, but it's just to give an idea.    </p>
<p>Now we are ready to start the simulation with     </p>
<div class="code"><pre>mpirun -np 2 ./Gadget2 galaxy.param
</pre></div>


<p>where <code>-np</code> sets the number of processes/processors to be used in parallel.  <br>
When the simulation stops we can analyze it with the tools provided in the <code>Analysis</code> folder or, if you like me don't own an IDL license and don't feel comfortable with IDL/Fortran/C for the data analysis, with something like (to be run in out/plots/):    </p>
<div class="code"><pre><span class="c">#!/use/bin/env python</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">Popen</span><span class="p">,</span> <span class="n">PIPE</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Process</span><span class="p">,</span> <span class="n">Queue</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">tables</span> <span class="kn">as</span> <span class="nn">tb</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>

<span class="sd">"""This script will plot in parallel the .h5 snapshots created by Gadget2 test</span>
<span class="sd">runs one after the other!:).</span>
<span class="sd">FIXME: i need a way to wait for the final time count the end of the processes</span>
<span class="sd">and a way to print the status</span>
<span class="sd">"""</span>

<span class="c"># Set the max number of processes</span>
<span class="n">n_procs</span> <span class="o">=</span> <span class="mi">3</span>

<span class="c"># Set the number of snapshot to be plotted</span>
<span class="n">n_snap</span> <span class="o">=</span> <span class="mi">401</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="k">print</span> <span class="s">"Defining workers..."</span>

<span class="k">def</span> <span class="nf">worker</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">output</span><span class="p">):</span>
    <span class="k">while</span> <span class="nb">input</span><span class="o">.</span><span class="n">qsize</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">item</span> <span class="o">=</span> <span class="nb">input</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span> <span class="mi">10</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="mi">100</span><span class="p">:</span> <span class="n">j</span><span class="o">=</span><span class="s">"0"</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">j</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">try</span><span class="p">:</span>
<span class="c">#     print "considering file ../snapshot_"+j+".hdf5"</span>
<span class="c">#     print "open file "</span>
            <span class="n">h5</span> <span class="o">=</span> <span class="n">tb</span><span class="o">.</span><span class="n">openFile</span><span class="p">(</span><span class="s">"../snapshot_"</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="s">".hdf5"</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span>
<span class="c">#     print "file opened, set variables"</span>
            <span class="n">halo</span> <span class="o">=</span> <span class="n">h5</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">PartType1</span>
            <span class="n">disk</span> <span class="o">=</span> <span class="n">h5</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">PartType2</span>
<span class="c">#            print "setted, inizialize figure"</span>
            <span class="n">fig2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">Axes3D</span><span class="p">(</span><span class="n">fig2</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">disk</span><span class="o">.</span><span class="n">Coordinates</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> 
                       <span class="n">disk</span><span class="o">.</span><span class="n">Coordinates</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span>
                       <span class="n">disk</span><span class="o">.</span><span class="n">Coordinates</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span>
                       <span class="n">color</span><span class="o">=</span><span class="s">'red'</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">halo</span><span class="o">.</span><span class="n">Coordinates</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> 
                       <span class="n">halo</span><span class="o">.</span><span class="n">Coordinates</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span>
                       <span class="n">halo</span><span class="o">.</span><span class="n">Coordinates</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span>
                       <span class="n">color</span><span class="o">=</span><span class="s">'blue'</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s">'snap_'</span><span class="o">+</span><span class="n">j</span><span class="p">)</span>
<span class="c">#            print "done, closing file"</span>
            <span class="n">h5</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>  
<span class="c">#            print "closed"</span>

        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">"Work "</span><span class="o">+</span><span class="n">j</span><span class="o">+</span><span class="s">" not done, exit..."</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">fill_queue</span><span class="p">(</span><span class="n">task_queue</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_snap</span><span class="p">):</span>
        <span class="n">task_queue</span><span class="o">.</span><span class="n">put</span><span class="p">([</span><span class="n">i</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">task_queue</span>

<span class="k">def</span> <span class="nf">status</span><span class="p">(</span><span class="n">proc</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">proc</span><span class="o">.</span><span class="n">is_alive</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">'alive'</span>
    <span class="k">elif</span> <span class="n">proc</span><span class="o">.</span><span class="n">is_alive</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">'dead'</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">proc</span><span class="o">.</span><span class="n">is_alive</span><span class="p">()</span>

<span class="k">print</span> <span class="s">"Define queues..."</span>

<span class="n">input_queue</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">()</span>
<span class="n">output_queue</span> <span class="o">=</span> <span class="n">Queue</span><span class="p">()</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">input_queue</span> <span class="o">=</span> <span class="n">fill_queue</span><span class="p">(</span><span class="n">input_queue</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">"Queue not filled, exit..."</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

<span class="n">procs</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">try</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_procs</span><span class="p">):</span>
        <span class="n">procs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">worker</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">input_queue</span><span class="p">,</span>
<span class="n">output_queue</span><span class="p">)))</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">"Creating processes not complete, exit..."</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

<span class="k">try</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">procs</span><span class="p">:</span>
        <span class="n">i</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">"Start processes not complete, exit..."</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">procs</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">"Process "</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span><span class="s">" @ "</span> <span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">pid</span><span class="p">,</span> <span class="s">" is "</span><span class="p">,</span> <span class="n">status</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

<span class="k">print</span> <span class="s">"Done in "</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">t</span><span class="p">)</span><span class="o">+</span><span class="s">" seconds."</span>
</pre></div>


<p>Now we have one image for each snapshot, and if we are interested we can produce a video with:    </p>
<div class="code"><pre>mencoder mf://*.png -mf <span class="nv">fps</span><span class="o">=</span>25:type<span class="o">=</span>png -ovc lavc -lavcopts <span class="nv">vcodec</span><span class="o">=</span>mpeg4:mbd<span class="o">=</span>2:trell -vf <span class="nv">scale</span><span class="o">=</span>720:360 -oac copy -o output.mp4
</pre></div>


<p><a href="youtube%20http://www.youtube.com/watch">This</a> is the first basic video, with logarithmic time and perhaps there's something wrong with the coordinates on the axes.    </p></div>
    </div>
    </div>
    
        <ul class="pager">
            <li class="previous">
                <a href="gif2-files-python-reader.html" rel="prev">← Previous post</a>
            </li>
            <li class="next">
                <a href="phd-question-2-spherical-collapse.html" rel="next">Next post →</a>
            </li>
        </ul>

        
        


    

    </article>

    </div>
    </div>
    <!--End of body content-->
</div>
<div class="footerbox">
    Contents © 2015 <a href="mailto:brunetto.ziosi@gmail.com">brunetto</a> - <a href="https://plus.google.com/117554238100031566866?rel=author">G+ Profile</a> - Powered by <a href="http://nikola.ralsina.com.ar">Nikola</a>
</div>

            <script src="../assets/js/jquery-1.10.2.min.js" type="text/javascript"></script>
            <script src="../assets/js/bootstrap.min.js" type="text/javascript"></script>
        <script src="../assets/js/jquery.colorbox-min.js" type="text/javascript"></script>


    
<!-- Social buttons -->
<div id="addthisbox" class="addthis_toolbox addthis_peekaboo_style addthis_default_style addthis_label_style addthis_32x32_style">
<a class="addthis_button_more">Share</a>
<ul><li><a class="addthis_button_facebook"></a>
</li><li><a class="addthis_button_google_plusone_share"></a>
</li><li><a class="addthis_button_linkedin"></a>
</li><li><a class="addthis_button_twitter"></a>
</li></ul>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4f7088a56bb93798"></script>
<!-- End of social buttons -->


    <script type="text/javascript">jQuery("a.image-reference").colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});
    $(window).on('hashchange', function(){
        if (location.hash && $(location.hash)[0]) {
            $('body').animate({scrollTop: $(location.hash).offset().top - $('#navbar').outerHeight(true)*1.2 }, 1);
        }
    });
    $(document).ready(function(){$(window).trigger('hashchange')});
    </script>
    
    
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-51923245-1', 'brunettoziosi.eu');
  ga('send', 'pageview');

</script>

</body>
</html>