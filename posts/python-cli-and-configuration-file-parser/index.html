<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <title>
    Python CLI and configuration file parser // Post It!
  </title>

  <link href="http://gmpg.org/xfn/11" rel="profile">
<meta http-equiv="content-type" content="text/html; charset=utf-8">


<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

<meta name="description" content="">
<meta name="keywords" content="">
<meta name="author" content="Brunetto Ziosi">

  <meta property="og:title" content="Python CLI and configuration file parser" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:locale" content="en_US" />
<meta property="og:url" content="http://brunettoziosi.eu/posts/python-cli-and-configuration-file-parser/" />


  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/base-min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/pure-min.css">
  
  
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.5.0/grids-responsive-min.css">
  
  

  <link rel="stylesheet" href="http://brunettoziosi.eu/css/redlounge.css">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
  <link href='//fonts.googleapis.com/css?family=Raleway:400,200,100,700,300,500,600,800' rel='stylesheet' type='text/css'>
  <link href='//fonts.googleapis.com/css?family=Libre+Baskerville:400,700,400italic' rel='stylesheet' type='text/css'>

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.svg">

  
  <link href="" rel="alternate" type="application/rss+xml" title="Post It!" />

    
  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/tomorrow-night-bright.min.css">
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>


  

  

  
</head>

<body>
	

	<div id="layout" class="pure-g">
    <div class="sidebar pure-u-1 pure-u-md-1-4">
  <div class="header">
    

    <h1 class="brand-title">Post It!</h1>
    <h2 class="brand-tagline">Sticky digital notes
    </br>stuck on the Web!😃</h2>

    <nav class="nav">
      <ul class="nav-list">
        <li class="nav-item"><span class="nav-item-separator">//</span><a href="http://brunettoziosi.eu">Home</a></li>
        
          <li class="nav-item"><span class="nav-item-separator">//</span><a href="/posts">Blog</a></li>
        
          <li class="nav-item"><span class="nav-item-separator">//</span><a href="/pages/curriculum-vitae">CV</a></li>
        
          <li class="nav-item"><span class="nav-item-separator">//</span><a href="/pages">Pages</a></li>
        
      </ul>
    </nav>

    
    <div class="social-buttons">
      
        
        <a href="http://www.facebook.com/brunettoziosi" target="_blank"><i class='fa fa-facebook'></i></a>
        
      
        
        <a href="http://www.github.com/brunetto" target="_blank"><i class='fa fa-github'></i></a>
        
      
        
        <a href="http://plus.google.com/&#43;BrunettoZiosi" target="_blank"><i class='fa fa-google-plus'></i></a>
        
      
        
        <a href="https://instagram.com/elbrunz/" target="_blank"><i class='fa fa-instagram'></i></a>
        
      
        
        <a href="http://www.linkedin.com/in/brunettoziosi" target="_blank"><i class='fa fa-linkedin'></i></a>
        
      
        
        <a href="http://www.twitter.com/brunettoziosi" target="_blank"><i class='fa fa-twitter'></i></a>
        
      
      
    </div>
    

  </div>
</div>

	
	

    <div class="content pure-u-1 pure-u-md-3-4">
		<a name="top"></a>
		

		
			
	    
  		<section class="post">
            <h1 class="post-title">
              <a href="/posts/python-cli-and-configuration-file-parser/">Python CLI and configuration file parser</a>
            </h1>
            <h3 class="post-subtitle">
            	
            </h3>
            
            	<span class="post-date">
                	<span class="post-date-day"><sup>17</sup></span><span class="post-date-separator">/</span><span class="post-date-month">Nov</span> <span class="post-date-year">2011</span>
            	</span>
            	
            
            
            
            
            	
            		<span class="post-author-single">By <a class="post-author" href="http://brunettoziosi.eu" target="">Brunetto Ziosi</a></span>
            		




            	
            
            

			
			
				<div class="post-categories">
				
					<a class="post-category post-category-research" href="http://brunettoziosi.eu/categories/research">Research</a>
				
					<a class="post-category post-category-python" href="http://brunettoziosi.eu/categories/python">Python</a>
				
					<a class="post-category post-category-programming" href="http://brunettoziosi.eu/categories/programming">Programming</a>
				
					<a class="post-category post-category-post" href="http://brunettoziosi.eu/categories/post">Post</a>
				
				</div>
			

			
		    	<div class="social-sharing">
	<a class="share-button-facebook" onClick="return popupShare(this.href);" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fbrunettoziosi.eu%2fposts%2fpython-cli-and-configuration-file-parser%2f" target="_blank"><i class="fa fa-facebook"><span>Like</span></i></a>
	<a class="share-button-google-plus" onClick="return popupShare(this.href);" href="https://plus.google.com/share?url=http%3a%2f%2fbrunettoziosi.eu%2fposts%2fpython-cli-and-configuration-file-parser%2f" target="_blank"><i class="fa fa-google-plus"><span>Google +1</span></i></a>
	<a class="share-button-linkedin" onClick="return popupShare(this.href);" href="http://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2fbrunettoziosi.eu%2fposts%2fpython-cli-and-configuration-file-parser%2f&title=Python%20CLI%20and%20configuration%20file%20parser&summary=One%20of%20the%20first%20things%20I%20needed%20writing%20the%20code%20for%20my%20thesis%20was%20the%20ability%20to%20read%20options%20and%20parameters%20both%20from%20a%20configuration%20file%20and%20from%20the%20command%20line.%20After%20some%20attempts%20I%20have%20found%20%28at%20http%3a%2f%2fwww.decalage.info%29%20a%20file%20parser%20to%20read%20a%20configuration%20file%20and%20the%20Python%20library%20argparse%20for%20the%20command%20line%20parsing.%20In%20addition%20I%20have%20modified%20the%20file%20parser%20and%20I%26rsquo%3bve%20added%20a%20%26ldquo%3bvariable%20container%26rdquo%3b%20object%2c%20inspired%20by%20some%20snippets%20found%20somewhere%20on%20the%20web.}&source=Post%20It%21" target="_blank"><i class="fa fa-linkedin"><span>Share on LinkedIn</span></i></a>
	<a class="share-button-twitter" onClick="return popupShare(this.href);" href="http://twitter.com/share?text=Python%20CLI%20and%20configuration%20file%20parser&url=http%3a%2f%2fbrunettoziosi.eu%2fposts%2fpython-cli-and-configuration-file-parser%2f" target="_blank"><i class="fa fa-twitter"><span>Tweet</span></i></a>	
</div>
		    

			

            <p>One of the first things I needed writing the code for my thesis was the ability to read options and parameters both from a configuration file and from the command line. After some attempts I have found (at <a href="http://www.decalage.info/" target="_blank" title="http://www.decalage.info"><a href="http://www.decalage.info">http://www.decalage.info</a></a>) a file parser to read a configuration file and the Python library <a href="http://docs.python.org/dev/library/argparse.html" target="_blank" title="argparse">argparse</a> for the command line parsing. In addition I have modified the file parser and I&rsquo;ve added a &ldquo;variable container&rdquo; object, inspired by some snippets found somewhere on the web.<br />
<!-- TEASER_END -->
I chose to first parse the configuration file and after the command line options: if it&rsquo;s necessary the command line options will overwrite the file options.<br />
Let&rsquo;s consider the code, fully commented.</p>

<pre><code class="language-python">import argparse
def parse_config(filename):    
    &quot;&quot;&quot;Read the config file and store the variables into a dictionary.
    Thanks to http://www.decalage.info
    &quot;&quot;&quot;
    mlogger.info(&quot;Reading config file.&quot;)

    COMMENT_CHAR = '#'
    OPTION_CHAR =  '='

    options = {}
    f = open(filename)
    for line in f:
        # First, remove comments:
        if COMMENT_CHAR in line:
            # split on comment char, keep only the part before
            line, comment = line.split(COMMENT_CHAR, 1)
        # Second, find lines with an option=value:
        if OPTION_CHAR in line:
            # split on option char:
            option, value = line.split(OPTION_CHAR, 1)
            # strip spaces:
            option = option.strip()
            value = value.strip()
            # store in dictionary:
            options[option] = value
    f.close()
    return options
</code></pre>

<p>And this is the container for the variables, also clearly commented.</p>

<pre><code class="language-python">class Bunch(object):
    &quot;&quot;&quot;Create a dictionary object containing all the initial variables.
    &quot;&quot;&quot;

    def __init__(self, d=None):
        if d is not None: self.__dict__.update(d)

def var(filename):
    &quot;&quot;&quot;Read the initial variables and return a dictionary object.

    Parameters
    ==========

    filename = string, the name of the config file

    Returns
    =======

    Bunch(locals()) = dictionary object containing the local variables

    &quot;&quot;&quot;

    # Read the config file and create a dictionary.
    options = parse_config(filename)

    # Common variables.
    mlogger.info(&quot;Defining common parameters.&quot;)

    parameter_1 = options['parameter_1']
    parameter_2 = options['parameter_2']
    parameter_3 = None
    option_1 = False

    return Bunch(locals())
</code></pre>

<p>Now the commented code for the command line parsing.</p>

<pre><code class="language-python"># Read the configuration file.
    v = mod.var('../config.txt')

    # Check if there are CLI arguments, if yes start parsing.
    if argv is None:
        # Check for CLI variables.
        argv = sys.argv

        # Create the parser object.
        parser = argparse.ArgumentParser()

        # Create the parser entry.
        parser.add_argument('-p1', '-parameter_1', '--parameter_1', action='store', dest='parameter_1', default=v.parameter_1, 
                    help='Parameter 1 description')
        parser.add_argument('-p2', '-parameter_2', '--oparameter_2', action='store', dest='parameter_2', default=v.parameter_2, 
                    help='Parameter 2 description')
        parser.add_argument('-o', '--option', action='store_true', dest='option', default=None, 
                    help='Oprion description')

        # Add the parsed variables to a container object
        cli = parser.parse_args()

        # Overwrite the config file parameters
        v.parameter_1 = cli.parameter_1
        v.parameter_2 = cli.parameter_2
        v.option = cli.option

    elif isinstance(argv, dict):
        # Reading variables passed to Main as a function (Guido docet
        # http://www.artima.com/weblogs/viewpost.jsp?thread=4829).
        for i in argv.keys():
            if i in (&quot;-p1&quot;, &quot;--parameter_1&quot;): 
                v.parameter_1 = argv[i]
            elif i in (&quot;-p2&quot;, &quot;--parameter_2&quot;): 
                v.parameter_2 = argv[i]
            elif i in (&quot;-o&quot;, &quot;--option&quot;):
                v.option = True
            else:
                print &quot;Wrong parameter passed to main function, exit!!!&quot;
                sys.exit(1)
</code></pre>

<p>The configuration file look like this:</p>

<pre><code class="language-python"># Short description of parameter 1
parameter_1 = value

# Short description of parameter 2
parameter_2 = None
</code></pre>

	
			
		    	<div class="social-sharing">
	<a class="share-button-facebook" onClick="return popupShare(this.href);" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fbrunettoziosi.eu%2fposts%2fpython-cli-and-configuration-file-parser%2f" target="_blank"><i class="fa fa-facebook"><span>Like</span></i></a>
	<a class="share-button-google-plus" onClick="return popupShare(this.href);" href="https://plus.google.com/share?url=http%3a%2f%2fbrunettoziosi.eu%2fposts%2fpython-cli-and-configuration-file-parser%2f" target="_blank"><i class="fa fa-google-plus"><span>Google +1</span></i></a>
	<a class="share-button-linkedin" onClick="return popupShare(this.href);" href="http://www.linkedin.com/shareArticle?mini=true&url=http%3a%2f%2fbrunettoziosi.eu%2fposts%2fpython-cli-and-configuration-file-parser%2f&title=Python%20CLI%20and%20configuration%20file%20parser&summary=One%20of%20the%20first%20things%20I%20needed%20writing%20the%20code%20for%20my%20thesis%20was%20the%20ability%20to%20read%20options%20and%20parameters%20both%20from%20a%20configuration%20file%20and%20from%20the%20command%20line.%20After%20some%20attempts%20I%20have%20found%20%28at%20http%3a%2f%2fwww.decalage.info%29%20a%20file%20parser%20to%20read%20a%20configuration%20file%20and%20the%20Python%20library%20argparse%20for%20the%20command%20line%20parsing.%20In%20addition%20I%20have%20modified%20the%20file%20parser%20and%20I%26rsquo%3bve%20added%20a%20%26ldquo%3bvariable%20container%26rdquo%3b%20object%2c%20inspired%20by%20some%20snippets%20found%20somewhere%20on%20the%20web.}&source=Post%20It%21" target="_blank"><i class="fa fa-linkedin"><span>Share on LinkedIn</span></i></a>
	<a class="share-button-twitter" onClick="return popupShare(this.href);" href="http://twitter.com/share?text=Python%20CLI%20and%20configuration%20file%20parser&url=http%3a%2f%2fbrunettoziosi.eu%2fposts%2fpython-cli-and-configuration-file-parser%2f" target="_blank"><i class="fa fa-twitter"><span>Tweet</span></i></a>	
</div>
		    

			
				<div class="tags-list">
					<span class="dark-red">Tags</span><span class="decorative-marker">//</span>
					
	                <a class="post-tag post-tag-programming" href="http://brunettoziosi.eu/tags/programming">programming</a>,
	                
	                <a class="post-tag post-tag-research" href="http://brunettoziosi.eu/tags/research">research</a>,
	                
	                <a class="post-tag post-tag-python" href="http://brunettoziosi.eu/tags/python">python</a>,
	                
				</div>
			

			
				<div class="paging">
					<span class="paging-label">More Reading</span>
					
					<div class="paging-newer">
						<span class="dark-red">Newer</span><span class="decorative-marker">//</span>
						<a class="paging-link" href="/posts/python-slicing-rebinning-and-indexing/">Python slicing, rebinning and indexing</a>
		            </div>
		            

					
					<div class="paging-older">
						<span class="dark-red">Older</span><span class="decorative-marker">//</span>
			            <a class="paging-link" href="/posts/python-logging/">Python logging</a>
		            </div>
		            
	            </div>
            
          </section>
          

          	<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    if (window.location.hostname == "localhost")
        return;

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = "brunettoziosieu";   
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

          
        
      <div class="footer">
	<hr class="thin" />
	<div class="pure-menu pure-menu-horizontal pure-menu-open">
		<ul class="footer-menu">
		
		</ul>
	</div>
	<p>&copy; 2016 
	<a href="https://plus.google.com/117554238100031566866?rel=author">Brunetto Ziosi</a>. All rights reserved. </br>
	Theme by <a href="https://github.com/tmaiaroto/hugo-redlounge">Tom Maiaroto</a>, Generated (with ❤) using <a href="http://gohugo.io/">Hugo.</a></p>
</div>

    </div>
  </div>
	

	
		<script type="text/javascript">
			function popupShare(url) {
				window.open(url, '_blank', 'scrollbars,resizable,height=525,width=600');
				return false;
			}
		</script>
	

  
  <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML&delayStartupUntil=configured" type="text/javascript"></script>
    <script type="text/javascript">
    
    MathJax.Hub.Config({
      tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
      extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js"]
      }
    });
    MathJax.Hub.Queue(function() {
      $(MathJax.Hub.getAllJax()).map(function(index, elem) {
        return(elem.SourceElement());
      }).parent().addClass('has-jax');
    });
    MathJax.Hub.Configured();
    </script>
</body>
</html>
